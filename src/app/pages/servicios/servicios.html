<div class="servicios-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Gestión de Servicios Públicos</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <mat-tab-group>
        <!-- Servicios Tab -->
        <mat-tab label="Servicios">
          <div class="tab-content">
            <div class="actions">
              <button mat-raised-button color="primary" (click)="toggleAddServicioForm()">
                <mat-icon>{{ showAddServicioForm ? 'close' : 'add' }}</mat-icon>
                {{ showAddServicioForm ? 'Cancelar' : 'Agregar Servicio' }}
              </button>
            </div>

            @if (showAddServicioForm) {
              <div class="add-form">
                <h3>Nuevo Servicio</h3>
                <div class="form-grid">
                  <mat-form-field>
                    <mat-label>Nombre</mat-label>
                    <input matInput [(ngModel)]="newServicio.nombre" required>
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Tipo</mat-label>
                    <mat-select [(ngModel)]="newServicio.tipo" required>
                      @for(tipo of tiposServicio; track tipo) {
                        <mat-option [value]="tipo">{{ tipo | titlecase }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Descripción</mat-label>
                    <textarea matInput [(ngModel)]="newServicio.descripcion" rows="3"></textarea>
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Estado</mat-label>
                    <mat-select [(ngModel)]="newServicio.estado">
                      <mat-option value="activo">Activo</mat-option>
                      <mat-option value="inactivo">Inactivo</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="form-actions">
                  <button mat-raised-button color="primary" (click)="addServicio()">
                    <mat-icon>save</mat-icon>
                    Guardar
                  </button>
                </div>
              </div>
            }

            <table mat-table [dataSource]="servicioSrv.servicios()" class="data-table">
              <ng-container matColumnDef="id_servicio">
                <th mat-header-cell *matHeaderCellDef>ID</th>
                <td mat-cell *matCellDef="let servicio">{{ servicio.id_servicio }}</td>
              </ng-container>

              <ng-container matColumnDef="nombre">
                <th mat-header-cell *matHeaderCellDef>Nombre</th>
                <td mat-cell *matCellDef="let servicio">{{ servicio.nombre }}</td>
              </ng-container>

              <ng-container matColumnDef="tipo">
                <th mat-header-cell *matHeaderCellDef>Tipo</th>
                <td mat-cell *matCellDef="let servicio">{{ servicio.tipo | titlecase }}</td>
              </ng-container>

              <ng-container matColumnDef="descripcion">
                <th mat-header-cell *matHeaderCellDef>Descripción</th>
                <td mat-cell *matCellDef="let servicio">{{ servicio.descripcion }}</td>
              </ng-container>

              <ng-container matColumnDef="estado">
                <th mat-header-cell *matHeaderCellDef>Estado</th>
                <td mat-cell *matCellDef="let servicio">
                  <span [class]="'status-badge status-' + servicio.estado">{{ servicio.estado }}</span>
                </td>
              </ng-container>

              <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let servicio">
                  <button mat-icon-button color="warn" (click)="deleteServicio(servicio.id_servicio)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="serviciosColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: serviciosColumns;"></tr>
            </table>
          </div>
        </mat-tab>

        <!-- Proveedores Tab -->
        <mat-tab label="Proveedores">
          <div class="tab-content">
            <div class="actions">
              <button mat-raised-button color="primary" (click)="toggleAddProveedorForm()">
                <mat-icon>{{ showAddProveedorForm ? 'close' : 'add' }}</mat-icon>
                {{ showAddProveedorForm ? 'Cancelar' : 'Agregar Proveedor' }}
              </button>
            </div>

            @if (showAddProveedorForm) {
              <div class="add-form">
                <h3>Nuevo Proveedor</h3>
                <div class="form-grid">
                  <mat-form-field>
                    <mat-label>Nombre</mat-label>
                    <input matInput [(ngModel)]="newProveedor.nombre" required>
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Teléfono</mat-label>
                    <input matInput [(ngModel)]="newProveedor.telefono">
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Email</mat-label>
                    <input matInput type="email" [(ngModel)]="newProveedor.email">
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Dirección</mat-label>
                    <input matInput [(ngModel)]="newProveedor.direccion">
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Estado</mat-label>
                    <mat-select [(ngModel)]="newProveedor.estado">
                      <mat-option value="activo">Activo</mat-option>
                      <mat-option value="inactivo">Inactivo</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="form-actions">
                  <button mat-raised-button color="primary" (click)="addProveedor()">
                    <mat-icon>save</mat-icon>
                    Guardar
                  </button>
                </div>
              </div>
            }

            <table mat-table [dataSource]="servicioSrv.proveedores()" class="data-table">
              <ng-container matColumnDef="id_proveedor">
                <th mat-header-cell *matHeaderCellDef>ID</th>
                <td mat-cell *matCellDef="let proveedor">{{ proveedor.id_proveedor }}</td>
              </ng-container>

              <ng-container matColumnDef="nombre">
                <th mat-header-cell *matHeaderCellDef>Nombre</th>
                <td mat-cell *matCellDef="let proveedor">{{ proveedor.nombre }}</td>
              </ng-container>

              <ng-container matColumnDef="telefono">
                <th mat-header-cell *matHeaderCellDef>Teléfono</th>
                <td mat-cell *matCellDef="let proveedor">{{ proveedor.telefono }}</td>
              </ng-container>

              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef>Email</th>
                <td mat-cell *matCellDef="let proveedor">{{ proveedor.email }}</td>
              </ng-container>

              <ng-container matColumnDef="direccion">
                <th mat-header-cell *matHeaderCellDef>Dirección</th>
                <td mat-cell *matCellDef="let proveedor">{{ proveedor.direccion }}</td>
              </ng-container>

              <ng-container matColumnDef="estado">
                <th mat-header-cell *matHeaderCellDef>Estado</th>
                <td mat-cell *matCellDef="let proveedor">
                  <span [class]="'status-badge status-' + proveedor.estado">{{ proveedor.estado }}</span>
                </td>
              </ng-container>

              <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let proveedor">
                  <button mat-icon-button color="warn" (click)="deleteProveedor(proveedor.id_proveedor)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="proveedoresColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: proveedoresColumns;"></tr>
            </table>
          </div>
        </mat-tab>

        <!-- Medidores Tab -->
        <mat-tab label="Medidores">
          <div class="tab-content">
            <div class="actions">
              <button mat-raised-button color="primary" (click)="toggleAddMedidorForm()">
                <mat-icon>{{ showAddMedidorForm ? 'close' : 'add' }}</mat-icon>
                {{ showAddMedidorForm ? 'Cancelar' : 'Agregar Medidor' }}
              </button>
            </div>

            @if (showAddMedidorForm) {
              <div class="add-form">
                <h3>Nuevo Medidor</h3>
                <div class="form-grid">
                  <mat-form-field>
                    <mat-label>Número de Serie</mat-label>
                    <input matInput [(ngModel)]="newMedidor.numero_serie" required>
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Tipo</mat-label>
                    <mat-select [(ngModel)]="newMedidor.tipo" required>
                      @for(tipo of tiposServicio; track tipo) {
                        <mat-option [value]="tipo">{{ tipo | titlecase }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Ubicación</mat-label>
                    <input matInput [(ngModel)]="newMedidor.ubicacion">
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Fecha de Instalación</mat-label>
                    <input matInput type="date" [(ngModel)]="newMedidor.fecha_instalacion">
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Estado</mat-label>
                    <mat-select [(ngModel)]="newMedidor.estado">
                      <mat-option value="activo">Activo</mat-option>
                      <mat-option value="inactivo">Inactivo</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="form-actions">
                  <button mat-raised-button color="primary" (click)="addMedidor()">
                    <mat-icon>save</mat-icon>
                    Guardar
                  </button>
                </div>
              </div>
            }

            <table mat-table [dataSource]="servicioSrv.medidores()" class="data-table">
              <ng-container matColumnDef="id_medidor">
                <th mat-header-cell *matHeaderCellDef>ID</th>
                <td mat-cell *matCellDef="let medidor">{{ medidor.id_medidor }}</td>
              </ng-container>

              <ng-container matColumnDef="numero_serie">
                <th mat-header-cell *matHeaderCellDef>Número de Serie</th>
                <td mat-cell *matCellDef="let medidor">{{ medidor.numero_serie }}</td>
              </ng-container>

              <ng-container matColumnDef="tipo">
                <th mat-header-cell *matHeaderCellDef>Tipo</th>
                <td mat-cell *matCellDef="let medidor">{{ medidor.tipo | titlecase }}</td>
              </ng-container>

              <ng-container matColumnDef="ubicacion">
                <th mat-header-cell *matHeaderCellDef>Ubicación</th>
                <td mat-cell *matCellDef="let medidor">{{ medidor.ubicacion }}</td>
              </ng-container>

              <ng-container matColumnDef="fecha_instalacion">
                <th mat-header-cell *matHeaderCellDef>Fecha de Instalación</th>
                <td mat-cell *matCellDef="let medidor">{{ medidor.fecha_instalacion }}</td>
              </ng-container>

              <ng-container matColumnDef="estado">
                <th mat-header-cell *matHeaderCellDef>Estado</th>
                <td mat-cell *matCellDef="let medidor">
                  <span [class]="'status-badge status-' + medidor.estado">{{ medidor.estado }}</span>
                </td>
              </ng-container>

              <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let medidor">
                  <button mat-icon-button color="warn" (click)="deleteMedidor(medidor.id_medidor)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="medidoresColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: medidoresColumns;"></tr>
            </table>
          </div>
        </mat-tab>

        <!-- Tipos de Reclamo Tab -->
        <mat-tab label="Tipos de Reclamo">
          <div class="tab-content">
            <div class="actions">
              <button mat-raised-button color="primary" (click)="toggleAddTipoReclamoForm()">
                <mat-icon>{{ showAddTipoReclamoForm ? 'close' : 'add' }}</mat-icon>
                {{ showAddTipoReclamoForm ? 'Cancelar' : 'Agregar Tipo de Reclamo' }}
              </button>
            </div>

            @if (showAddTipoReclamoForm) {
              <div class="add-form">
                <h3>Nuevo Tipo de Reclamo</h3>
                <div class="form-grid">
                  <mat-form-field>
                    <mat-label>Nombre</mat-label>
                    <input matInput [(ngModel)]="newTipoReclamo.nombre" required>
                  </mat-form-field>

                  <mat-form-field>
                    <mat-label>Descripción</mat-label>
                    <textarea matInput [(ngModel)]="newTipoReclamo.descripcion" rows="3"></textarea>
                  </mat-form-field>
                </div>

                <div class="form-actions">
                  <button mat-raised-button color="primary" (click)="addTipoReclamo()">
                    <mat-icon>save</mat-icon>
                    Guardar
                  </button>
                </div>
              </div>
            }

            <table mat-table [dataSource]="servicioSrv.tiposReclamo()" class="data-table">
              <ng-container matColumnDef="id_tipo_reclamo">
                <th mat-header-cell *matHeaderCellDef>ID</th>
                <td mat-cell *matCellDef="let tipo">{{ tipo.id_tipo_reclamo }}</td>
              </ng-container>

              <ng-container matColumnDef="nombre">
                <th mat-header-cell *matHeaderCellDef>Nombre</th>
                <td mat-cell *matCellDef="let tipo">{{ tipo.nombre }}</td>
              </ng-container>

              <ng-container matColumnDef="descripcion">
                <th mat-header-cell *matHeaderCellDef>Descripción</th>
                <td mat-cell *matCellDef="let tipo">{{ tipo.descripcion }}</td>
              </ng-container>

              <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let tipo">
                  <button mat-icon-button color="warn" (click)="deleteTipoReclamo(tipo.id_tipo_reclamo)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="tiposReclamoColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: tiposReclamoColumns;"></tr>
            </table>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</div>
